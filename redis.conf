# ============================================
# Redis Konfiguration - Sichere Production Setup
# ============================================
# Erstellt: 2024-12-XX
# Container: hd_app_chart-redis-1
# ============================================

# ============================================
# NETZWERK
# ============================================

# Nur an localhost binden (sicherer)
bind 127.0.0.1 ::1

# Port
port 6379

# TCP Keepalive
tcp-keepalive 300

# TCP Backlog
tcp-backlog 511

# ============================================
# SICHERHEIT
# ============================================

# Passwort (WICHTIG: In .env Datei speichern!)
requirepass IJnAscu6TbR7mtarXKoFE3NGd2Q1xBi5

# Protected Mode aktivieren
protected-mode yes

# Gefährliche Befehle deaktivieren
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command DEBUG ""

# Gefährliche Befehle umbenennen (für Admin-Zugriff)
# Verwenden Sie die umbenannten Befehle nur für Wartung!
rename-command CONFIG "CONFIG_a1b2c3d4e5f6"
rename-command SHUTDOWN "SHUTDOWN_a1b2c3d4e5f6"

# ============================================
# MEMORY MANAGEMENT
# ============================================

# Max Memory auf 512 MB setzen
maxmemory 512mb

# Memory Policy: LRU (Least Recently Used)
maxmemory-policy allkeys-lru

# Max Memory Samples für LRU
maxmemory-samples 5

# ============================================
# PERSISTENZ
# ============================================

# AOF (Append Only File) aktivieren
appendonly yes

# AOF Dateiname
appendfilename "appendonly.aof"

# AOF Sync-Strategie: everysec (Balance zwischen Performance und Sicherheit)
appendfsync everysec

# AOF Rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# AOF Load bei Start
aof-load-truncated yes

# AOF Use RDB Preamble
aof-use-rdb-preamble yes

# RDB Kompression
rdbcompression yes

# RDB Checksum
rdbchecksum yes

# RDB Dateiname
dbfilename dump.rdb

# Save-Intervalle (optional, da AOF aktiviert)
# save 3600 1
# save 300 100
# save 60 10000

# Datenverzeichnis
dir /data

# ============================================
# LOGGING
# ============================================

# Log Level: notice (Production)
loglevel notice

# Logfile (optional)
# logfile ""

# Syslog deaktiviert
syslog-enabled no

# ============================================
# CLIENT MANAGEMENT
# ============================================

# Max Clients
maxclients 10000

# Client Timeout (0 = deaktiviert)
timeout 0

# Client Query Buffer Limit
client-query-buffer-limit 1gb

# Client Output Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# ============================================
# REPLIKATION (Optional)
# ============================================

# Replica Read Only
replica-read-only yes

# Replica Serve Stale Data
replica-serve-stale-data yes

# ============================================
# TLS (Optional - für Production empfohlen)
# ============================================

# TLS Port (0 = deaktiviert)
# tls-port 6380

# TLS Zertifikate (wenn TLS aktiviert)
# tls-cert-file /path/to/redis.crt
# tls-key-file /path/to/redis.key
# tls-ca-cert-file /path/to/ca.crt

# TLS Auth Clients
# tls-auth-clients yes

# ============================================
# ACL (Access Control Lists)
# ============================================

# ACL File (für persistente User-Konfiguration)
# aclfile /data/users.acl  # Auskommentiert - Datei existiert noch nicht

# ACL Pubsub Default
acl-pubsub-default resetchannels

# ============================================
# PERFORMANCE
# ============================================

# Hz (Hertz) - Frequenz für Hintergrund-Aufgaben
hz 10

# Dynamic Hz
dynamic-hz yes

# Active Rehashing
activerehashing yes

# Lazy Free (für bessere Performance)
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no

# ============================================
# DATENBANKEN
# ============================================

# Anzahl Datenbanken
databases 16

# ============================================
# SLOW LOG
# ============================================

# Slow Log Threshold (Mikrosekunden)
slowlog-log-slower-than 10000

# Slow Log Max Length
slowlog-max-len 128

# ============================================
# LATENCY MONITORING
# ============================================

# Latency Monitor Threshold (Mikrosekunden, 0 = deaktiviert)
latency-monitor-threshold 0

# Latency Tracking
latency-tracking yes

# ============================================
# ADVANCED CONFIG
# ============================================

# Hash Max Ziplist Entries
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List Max Ziplist Size
list-max-ziplist-size -2

# List Compress Depth
list-compress-depth 0

# Set Max Intset Entries
set-max-intset-entries 512

# Zset Max Ziplist Entries
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Hyperloglog Sparse Max Bytes
hll-sparse-max-bytes 3000

# Stream Node Max Bytes
stream-node-max-bytes 4096
stream-node-max-entries 100

# ============================================
# MODULES
# ============================================

# Module Command (deaktiviert)
enable-module-command no

# ============================================
# ENDE DER KONFIGURATION
# ============================================

